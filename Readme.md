# EduVision CRM

Сучасна CRM для навчальних закладів з учнями 2–18 років. Надає керування учнями та батьками, курсами, зарахуваннями, оплатами й безпечним сховищем API-ключів банку для автоматичних поповнень.

## Що всередині
- **FastAPI + SQLite**: легкий сервер, готовий до локального запуску.
- **Авторизація токеном**: логін через email/пароль, вбудований токен доступу.
- **Вік учня**: обчислення віку на основі дати народження при кожному читанні.
- **Оплати**: фіксація сум за рік/місяць/заняття через поле `period` (вільний формат: `2024`, `2024-09`, `2024-Q1`).
- **Банківські API-ключі**: шифрування за допомогою Fernet, доступ лише адміну.

## Швидкий старт
1. **Встановіть залежності**
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```
2. **Запустіть сервер**
   ```bash
   uvicorn app.main:app --reload
   ```
3. **Створений за замовчуванням адміністратор** (створюється на старті):
   - Email: `gammmerx@gmail.com`
   - Пароль: `апроль 123456.`
4. **Отримайте токен**
   ```bash
   curl -X POST http://127.0.0.1:8000/auth/login \
     -H "Content-Type: application/json" \
     -d '{"email":"gammmerx@gmail.com","password":"апроль 123456."}'
   ```
   Використовуйте `access_token` з відповіді у заголовку `Authorization: Bearer <token>`.

## Основні ендпоінти
- `POST /users` — створення користувача (лише адміністратор).
- `POST /parents` — додати батьків/опікунів.
- `POST /students` та `GET /students` — створити й переглянути учнів з розрахунком віку.
- `POST /courses` — додати курс.
- `POST /enrollments` — зарахувати учня на курс (з датою початку/завершення).
- `POST /payments` — зафіксувати оплату із зазначенням періоду та методу (готівка/переказ/заняття).
- `POST /api-keys` та `GET /api-keys` — зберегти/переглянути зашифровані API-ключі банку (лише адміністратор).
- `GET /health` — перевірка стану сервера.

## Нотатки безпеки
- **Шифрування ключів**: використовується Fernet. Задайте `FERNET_SECRET` у змінних середовища для стабільного ключа шифрування між перезапусками.
- **Паролі**: зберігаються у вигляді bcrypt-хешів.
- **Токени**: зберігаються в оперативній памʼяті сервера; при перезапуску користувачам потрібно увійти знову.
- **SQLite**: база створюється у каталозі `data/eduvision.db`; для продакшену використовуйте керовану СУБД.

## Подальші кроки
- Додати повноцінний JWT та рефреш-токени.
- Впровадити ролі (вчитель/бухгалтер/батько) та фільтрацію доступу.
- Додати автоматичну інтеграцію з банком для поповнення балансу учня/родини.
- Розгорнути CI/CD та сканування секретів перед релізом.
