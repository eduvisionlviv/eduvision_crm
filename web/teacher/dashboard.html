<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞–±—ñ–Ω–µ—Ç –≤—á–∏—Ç–µ–ª—è - EduVision CRM</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span>üìö</span>
        <span>EduVision CRM</span>
      </div>
      <nav>
        <ul class="sidebar-nav">
          <li><a href="/teacher/dashboard.html" class="active"><span class="icon">üìä</span> –ì–æ–ª–æ–≤–Ω–∞</a></li>
          <li><a href="/teacher/groups.html"><span class="icon">üë•</span> –ú–æ—ó –≥—Ä—É–ø–∏</a></li>
          <li><a href="/teacher/attendance.html"><span class="icon">‚úÖ</span> –í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å</a></li>
          <li><a href="/teacher/schedule.html"><span class="icon">üìÖ</span> –†–æ–∑–∫–ª–∞–¥</a></li>
          <li><a href="#" id="logout-btn"><span class="icon">üö™</span> –í–∏—Ö—ñ–¥</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <h1 class="header-title">–í—ñ—Ç–∞—î–º–æ, <span id="teacher-name">–í—á–∏—Ç–µ–ª—å</span>!</h1>
        <div class="header-actions">
          <span class="text-muted">–ö–∞–±—ñ–Ω–µ—Ç –≤—á–∏—Ç–µ–ª—è</span>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-3">
        <div class="stat-card">
          <div class="stat-label">–ú–æ—ó –≥—Ä—É–ø–∏</div>
          <div class="stat-value" id="my-groups">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–í—Å—å–æ–≥–æ —É—á–Ω—ñ–≤</div>
          <div class="stat-value" id="total-students">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–ó–∞–Ω—è—Ç—å —Å—å–æ–≥–æ–¥–Ω—ñ</div>
          <div class="stat-value" id="lessons-today">-</div>
        </div>
      </div>

      <!-- My Groups -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">–ú–æ—ó –≥—Ä—É–ø–∏</h2>
          <a href="/teacher/groups.html" class="btn btn-sm btn-secondary">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ</a>
        </div>
        <div class="card-body">
          <div class="table-container" id="groups-container">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>
      </div>

      <!-- Upcoming Lessons -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">–ù–∞–π–±–ª–∏–∂—á—ñ –∑–∞–Ω—è—Ç—Ç—è</h2>
          <a href="/teacher/schedule.html" class="btn btn-sm btn-secondary">–í–µ—Å—å —Ä–æ–∑–∫–ª–∞–¥</a>
        </div>
        <div class="card-body">
          <div class="table-container" id="lessons-container">
            <div class="text-muted text-center">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
      <a href="/teacher/dashboard.html" class="bottom-nav-item active">
        <span class="icon">üìä</span>
        <span>–ì–æ–ª–æ–≤–Ω–∞</span>
      </a>
      <a href="/teacher/groups.html" class="bottom-nav-item">
        <span class="icon">üë•</span>
        <span>–ì—Ä—É–ø–∏</span>
      </a>
      <a href="/teacher/attendance.html" class="bottom-nav-item">
        <span class="icon">‚úÖ</span>
        <span>–í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å</span>
      </a>
      <a href="/teacher/schedule.html" class="bottom-nav-item">
        <span class="icon">üìÖ</span>
        <span>–†–æ–∑–∫–ª–∞–¥</span>
      </a>
    </nav>
  </div>

  <script src="/js/app.js"></script>
  <script>
    async function loadTeacherDashboard() {
      try {
        // Load user info
        if (User.data) {
          document.getElementById('teacher-name').textContent = User.data.user_name || '–í—á–∏—Ç–µ–ª—å';
          const teacherId = User.data.user_id;

          // Load teacher's groups
          const groupsRes = await API.get(`/groups?teacher_id=${teacherId}`);
          const groups = groupsRes.groups || [];
          
          document.getElementById('my-groups').textContent = groups.length;

          // Calculate total students
          const totalStudents = groups.reduce((sum, g) => sum + (g.current_students || 0), 0);
          document.getElementById('total-students').textContent = totalStudents;

          // Render groups table
          renderGroups(groups);

          // Load today's lessons (placeholder)
          document.getElementById('lessons-today').textContent = '0';
          renderLessons([]);
        }
      } catch (error) {
        console.error('Error loading teacher dashboard:', error);
        UI.showAlert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö', 'danger');
      }
    }

    function renderGroups(groups) {
      const container = document.getElementById('groups-container');
      
      if (groups.length === 0) {
        container.innerHTML = '<div class="text-center text-muted">–£ –≤–∞—Å –ø–æ–∫–∏ –Ω–µ–º–∞—î –≥—Ä—É–ø</div>';
        return;
      }

      const table = Table.create(
        groups,
        [
          { label: '–ù–∞–∑–≤–∞', field: 'name' },
          { label: '–ö—É—Ä—Å', render: row => row.courses?.name || '-' },
          { label: '–£—á–Ω—ñ', render: row => `${row.current_students || 0}/${row.max_students || 10}` },
          { label: '–ö—ñ–º–Ω–∞—Ç–∞', render: row => row.room || '-' }
        ],
        [
          { label: 'üëÅÔ∏è', class: 'btn-secondary', onClick: row => window.location.href = `/teacher/group.html?id=${row.id}` }
        ]
      );

      container.innerHTML = '';
      container.appendChild(table);
    }

    function renderLessons(lessons) {
      const container = document.getElementById('lessons-container');
      container.innerHTML = '<div class="text-center text-muted">–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–Ω—è—Ç—å</div>';
    }

    document.addEventListener('DOMContentLoaded', loadTeacherDashboard);
  </script>
</body>
</html>
