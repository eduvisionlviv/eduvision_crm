<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞–±—ñ–Ω–µ—Ç —É—á–Ω—è - EduVision CRM</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span>üìö</span>
        <span>EduVision CRM</span>
      </div>
      <nav>
        <ul class="sidebar-nav">
          <li><a href="/student/dashboard.html" class="active"><span class="icon">üìä</span> –ì–æ–ª–æ–≤–Ω–∞</a></li>
          <li><a href="/student/schedule.html"><span class="icon">üìÖ</span> –ú—ñ–π —Ä–æ–∑–∫–ª–∞–¥</a></li>
          <li><a href="/student/homework.html"><span class="icon">üìù</span> –î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</a></li>
          <li><a href="/student/progress.html"><span class="icon">‚≠ê</span> –ú—ñ–π –ø—Ä–æ–≥—Ä–µ—Å</a></li>
          <li><a href="#" id="logout-btn"><span class="icon">üö™</span> –í–∏—Ö—ñ–¥</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <h1 class="header-title">–í—ñ—Ç–∞—î–º–æ, <span id="student-name">–£—á–µ–Ω—å</span>!</h1>
        <div class="header-actions">
          <span class="text-muted">–ö–∞–±—ñ–Ω–µ—Ç —É—á–Ω—è</span>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-3">
        <div class="stat-card">
          <div class="stat-label">–ú–æ—ó –≥—Ä—É–ø–∏</div>
          <div class="stat-value" id="my-groups">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å</div>
          <div class="stat-value" id="attendance-rate">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</div>
          <div class="stat-value" id="homework-count">-</div>
        </div>
      </div>

      <!-- My Groups -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">–ú–æ—ó –≥—Ä—É–ø–∏</h2>
        </div>
        <div class="card-body">
          <div id="groups-container">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>
      </div>

      <!-- Upcoming Lessons -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">–ù–∞–π–±–ª–∏–∂—á—ñ –∑–∞–Ω—è—Ç—Ç—è</h2>
          <a href="/student/schedule.html" class="btn btn-sm btn-secondary">–í–µ—Å—å —Ä–æ–∑–∫–ª–∞–¥</a>
        </div>
        <div class="card-body">
          <div class="text-muted text-center">–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–Ω—è—Ç—å</div>
        </div>
      </div>

      <!-- Recent Homework -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
          <a href="/student/homework.html" class="btn btn-sm btn-secondary">–í—Å—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
        </div>
        <div class="card-body">
          <div class="text-muted text-center">–ù–µ–º–∞—î –¥–æ–º–∞—à–Ω—ñ—Ö –∑–∞–≤–¥–∞–Ω—å</div>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
      <a href="/student/dashboard.html" class="bottom-nav-item active">
        <span class="icon">üìä</span>
        <span>–ì–æ–ª–æ–≤–Ω–∞</span>
      </a>
      <a href="/student/schedule.html" class="bottom-nav-item">
        <span class="icon">üìÖ</span>
        <span>–†–æ–∑–∫–ª–∞–¥</span>
      </a>
      <a href="/student/homework.html" class="bottom-nav-item">
        <span class="icon">üìù</span>
        <span>–ó–∞–≤–¥–∞–Ω–Ω—è</span>
      </a>
      <a href="/student/progress.html" class="bottom-nav-item">
        <span class="icon">‚≠ê</span>
        <span>–ü—Ä–æ–≥—Ä–µ—Å</span>
      </a>
    </nav>
  </div>

  <script src="/js/app.js"></script>
  <script>
    async function loadStudentDashboard() {
      try {
        if (User.data) {
          document.getElementById('student-name').textContent = User.data.user_name || '–£—á–µ–Ω—å';
          const studentId = User.data.user_id;

          // Load student's groups
          const studentRes = await API.get(`/students/${studentId}`);
          const student = studentRes.student || {};
          const groups = student.groups || [];
          
          document.getElementById('my-groups').textContent = groups.length;

          // Render groups
          renderGroups(groups);

          // Load attendance rate (placeholder)
          document.getElementById('attendance-rate').textContent = '-';
          
          // Homework count (placeholder)
          document.getElementById('homework-count').textContent = '0';
        }
      } catch (error) {
        console.error('Error loading student dashboard:', error);
        UI.showAlert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö', 'danger');
      }
    }

    function renderGroups(groups) {
      const container = document.getElementById('groups-container');
      
      if (groups.length === 0) {
        container.innerHTML = '<div class="text-center text-muted">–í–∏ –Ω–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω—ñ –¥–æ –∂–æ–¥–Ω–æ—ó –≥—Ä—É–ø–∏</div>';
        return;
      }

      const list = groups.map(g => {
        const group = g.groups || {};
        const course = group.courses || {};
        return `
          <div style="padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px;">
            <div style="font-weight: 600; margin-bottom: 4px;">${group.name || '–ì—Ä—É–ø–∞'}</div>
            <div style="color: var(--text-secondary); font-size: 14px;">
              ${course.name || '–ö—É—Ä—Å'} ‚Ä¢ –ö—ñ–º–Ω–∞—Ç–∞ ${group.room || '-'}
            </div>
          </div>
        `;
      }).join('');

      container.innerHTML = list;
    }

    document.addEventListener('DOMContentLoaded', loadStudentDashboard);
  </script>
</body>
</html>
