<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫—É—Ä—Å–∞–º–∏ - EduVision CRM</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span>üìö</span>
        <span>EduVision CRM</span>
      </div>
      <nav>
        <ul class="sidebar-nav">
          <li><a href="/admin/dashboard.html"><span class="icon">üìä</span> –ì–æ–ª–æ–≤–Ω–∞</a></li>
          <li><a href="/admin/courses.html" class="active"><span class="icon">üìñ</span> –ö—É—Ä—Å–∏</a></li>
          <li><a href="/admin/groups.html"><span class="icon">üë•</span> –ì—Ä—É–ø–∏</a></li>
          <li><a href="/admin/students.html"><span class="icon">üéì</span> –£—á–Ω—ñ</a></li>
          <li><a href="#" id="logout-btn"><span class="icon">üö™</span> –í–∏—Ö—ñ–¥</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <h1 class="header-title">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫—É—Ä—Å–∞–º–∏</h1>
        <div class="header-actions">
          <button class="btn btn-primary" onclick="showCreateModal()">
            <span>‚ûï</span> –î–æ–¥–∞—Ç–∏ –∫—É—Ä—Å
          </button>
        </div>
      </div>

      <!-- Courses List -->
      <div class="card">
        <div class="table-container" id="courses-container">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
      <a href="/admin/dashboard.html" class="bottom-nav-item">
        <span class="icon">üìä</span>
        <span>–ì–æ–ª–æ–≤–Ω–∞</span>
      </a>
      <a href="/admin/groups.html" class="bottom-nav-item">
        <span class="icon">üë•</span>
        <span>–ì—Ä—É–ø–∏</span>
      </a>
      <a href="/admin/students.html" class="bottom-nav-item">
        <span class="icon">üéì</span>
        <span>–£—á–Ω—ñ</span>
      </a>
      <a href="/admin/settings.html" class="bottom-nav-item">
        <span class="icon">‚öôÔ∏è</span>
        <span>–©–µ</span>
      </a>
    </nav>
  </div>

  <!-- Create/Edit Modal -->
  <div class="modal" id="courseModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">–î–æ–¥–∞—Ç–∏ –∫—É—Ä—Å</h2>
        <button class="modal-close" onclick="hideModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="courseForm">
          <input type="hidden" id="courseId" name="id">
          
          <div class="form-group">
            <label class="form-label">–ù–∞–∑–≤–∞ –∫—É—Ä—Å—É *</label>
            <input type="text" class="form-input" id="courseName" name="name" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">–û–ø–∏—Å</label>
            <textarea class="form-textarea" id="courseDescription" name="description" rows="3"></textarea>
          </div>
          
          <div class="grid grid-2">
            <div class="form-group">
              <label class="form-label">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (–º—ñ—Å.)</label>
              <input type="number" class="form-input" id="courseDuration" name="duration_months" min="1">
            </div>
            
            <div class="form-group">
              <label class="form-label">–¶—ñ–Ω–∞ (–≥—Ä–Ω)</label>
              <input type="number" class="form-input" id="coursePrice" name="price" step="0.01" min="0">
            </div>
          </div>
          
          <div class="grid grid-2">
            <div class="form-group">
              <label class="form-label">–í—ñ–∫ (–≤—ñ–¥)</label>
              <input type="number" class="form-input" id="courseAgeMin" name="age_min" min="0">
            </div>
            
            <div class="form-group">
              <label class="form-label">–í—ñ–∫ (–¥–æ)</label>
              <input type="number" class="form-input" id="courseAgeMax" name="age_max" min="0">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button class="btn btn-primary" onclick="saveCourse()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
      </div>
    </div>
  </div>

  <script src="/js/app.js"></script>
  <script>
    let courses = [];

    async function loadCourses() {
      try {
        UI.showLoading('courses-container');
        const response = await API.get('/courses');
        courses = response.courses || [];
        renderCourses();
      } catch (error) {
        console.error('Error loading courses:', error);
        UI.showError('courses-container', '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤');
      }
    }

    function renderCourses() {
      const container = document.getElementById('courses-container');
      
      if (courses.length === 0) {
        container.innerHTML = '<div class="text-center text-muted"><p>–ù–µ–º–∞—î –∫—É—Ä—Å—ñ–≤. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–∏–π –∫—É—Ä—Å!</p></div>';
        return;
      }

      const table = Table.create(
        courses,
        [
          { label: '–ù–∞–∑–≤–∞', field: 'name' },
          { label: '–û–ø–∏—Å', render: row => row.description || '-' },
          { label: '–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å', render: row => row.duration_months ? `${row.duration_months} –º—ñ—Å.` : '-' },
          { label: '–í—ñ–∫', render: row => {
            if (row.age_min && row.age_max) return `${row.age_min}-${row.age_max} —Ä–æ–∫—ñ–≤`;
            return '-';
          }},
          { label: '–¶—ñ–Ω–∞', render: row => row.price ? UI.formatCurrency(row.price) : '-' },
          { label: '–°—Ç–∞—Ç—É—Å', render: row => 
            `<span class="badge ${row.is_active ? 'badge-success' : 'badge-danger'}">
              ${row.is_active ? '–ê–∫—Ç–∏–≤–Ω–∏–π' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–∏–π'}
            </span>`
          }
        ],
        [
          { label: '‚úèÔ∏è', class: 'btn-primary', onClick: editCourse },
          { label: 'üóëÔ∏è', class: 'btn-danger', onClick: deleteCourse }
        ]
      );

      container.innerHTML = '';
      container.appendChild(table);
    }

    function showCreateModal() {
      document.getElementById('modalTitle').textContent = '–î–æ–¥–∞—Ç–∏ –∫—É—Ä—Å';
      Form.reset('courseForm');
      UI.showModal('courseModal');
    }

    function editCourse(course) {
      document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫—É—Ä—Å';
      Form.setData('courseForm', course);
      UI.showModal('courseModal');
    }

    function hideModal() {
      UI.hideModal('courseModal');
    }

    async function saveCourse() {
      const form = document.getElementById('courseForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const data = Form.getData('courseForm');
      const courseId = data.id;
      delete data.id;

      try {
        if (courseId) {
          await API.put(`/courses/${courseId}`, data);
          UI.showAlert('–ö—É—Ä—Å –æ–Ω–æ–≤–ª–µ–Ω–æ', 'success');
        } else {
          await API.post('/courses', data);
          UI.showAlert('–ö—É—Ä—Å —Å—Ç–≤–æ—Ä–µ–Ω–æ', 'success');
        }
        
        hideModal();
        loadCourses();
      } catch (error) {
        UI.showAlert(error.message || '–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫—É—Ä—Å—É', 'danger');
      }
    }

    async function deleteCourse(course) {
      if (!confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫—É—Ä—Å "${course.name}"?`)) {
        return;
      }

      try {
        await API.delete(`/courses/${course.id}`);
        UI.showAlert('–ö—É—Ä—Å –≤–∏–¥–∞–ª–µ–Ω–æ', 'success');
        loadCourses();
      } catch (error) {
        UI.showAlert(error.message || '–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫—É—Ä—Å—É', 'danger');
      }
    }

    // Load courses on page load
    document.addEventListener('DOMContentLoaded', loadCourses);
  </script>
</body>
</html>
