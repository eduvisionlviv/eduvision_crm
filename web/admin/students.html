<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ÑƒÑ‡Ğ½ÑĞ¼Ğ¸ - EduVision CRM</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span>ğŸ“š</span>
        <span>EduVision CRM</span>
      </div>
      <nav>
        <ul class="sidebar-nav">
          <li><a href="/admin/dashboard.html"><span class="icon">ğŸ“Š</span> Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°</a></li>
          <li><a href="/admin/courses.html"><span class="icon">ğŸ“–</span> ĞšÑƒÑ€ÑĞ¸</a></li>
          <li><a href="/admin/groups.html"><span class="icon">ğŸ‘¥</span> Ğ“Ñ€ÑƒĞ¿Ğ¸</a></li>
          <li><a href="/admin/students.html" class="active"><span class="icon">ğŸ“</span> Ğ£Ñ‡Ğ½Ñ–</a></li>
          <li><a href="#" id="logout-btn"><span class="icon">ğŸšª</span> Ğ’Ğ¸Ñ…Ñ–Ğ´</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <h1 class="header-title">Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ÑƒÑ‡Ğ½ÑĞ¼Ğ¸</h1>
        <div class="header-actions">
          <input type="search" class="form-input" placeholder="ĞŸĞ¾ÑˆÑƒĞº..." id="searchInput" style="max-width: 300px;">
        </div>
      </div>

      <!-- Students List -->
      <div class="card">
        <div class="table-container" id="students-container">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
      <a href="/admin/dashboard.html" class="bottom-nav-item">
        <span class="icon">ğŸ“Š</span>
        <span>Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°</span>
      </a>
      <a href="/admin/groups.html" class="bottom-nav-item">
        <span class="icon">ğŸ‘¥</span>
        <span>Ğ“Ñ€ÑƒĞ¿Ğ¸</span>
      </a>
      <a href="/admin/students.html" class="bottom-nav-item active">
        <span class="icon">ğŸ“</span>
        <span>Ğ£Ñ‡Ğ½Ñ–</span>
      </a>
      <a href="/admin/settings.html" class="bottom-nav-item">
        <span class="icon">âš™ï¸</span>
        <span>Ğ©Ğµ</span>
      </a>
    </nav>
  </div>

  <script src="/js/app.js"></script>
  <script>
    let students = [];
    let filteredStudents = [];

    async function loadStudents() {
      try {
        UI.showLoading('students-container');
        const response = await API.get('/students');
        students = response.students || [];
        filteredStudents = students;
        renderStudents();
      } catch (error) {
        console.error('Error loading students:', error);
        UI.showError('students-container', 'ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ ÑƒÑ‡Ğ½Ñ–Ğ²');
      }
    }

    function renderStudents() {
      const container = document.getElementById('students-container');
      
      if (filteredStudents.length === 0) {
        container.innerHTML = '<div class="text-center text-muted"><p>Ğ£Ñ‡Ğ½Ñ–Ğ² Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾</p></div>';
        return;
      }

      const table = Table.create(
        filteredStudents,
        [
          { label: "Ğ†Ğ¼'Ñ", field: 'user_name' },
          { label: 'Email', field: 'user_email' },
          { label: 'Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½', render: row => row.user_phone || '-' },
          { label: 'ID', field: 'user_id' }
        ],
        [
          { label: 'ğŸ‘ï¸', class: 'btn-secondary', onClick: viewStudent }
        ]
      );

      container.innerHTML = '';
      container.appendChild(table);
    }

    function viewStudent(student) {
      window.location.href = `/admin/student.html?id=${student.user_id}`;
    }

    function filterStudents(searchTerm) {
      const term = searchTerm.toLowerCase();
      filteredStudents = students.filter(s => 
        (s.user_name || '').toLowerCase().includes(term) ||
        (s.user_email || '').toLowerCase().includes(term) ||
        (s.user_phone || '').includes(term)
      );
      renderStudents();
    }

    // Search functionality
    document.getElementById('searchInput').addEventListener('input', (e) => {
      filterStudents(e.target.value);
    });

    // Load data on page load
    document.addEventListener('DOMContentLoaded', loadStudents);
  </script>
</body>
</html>
