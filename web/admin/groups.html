<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—Ä—É–ø–∞–º–∏ - EduVision CRM</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span>üìö</span>
        <span>EduVision CRM</span>
      </div>
      <nav>
        <ul class="sidebar-nav">
          <li><a href="/admin/dashboard.html"><span class="icon">üìä</span> –ì–æ–ª–æ–≤–Ω–∞</a></li>
          <li><a href="/admin/courses.html"><span class="icon">üìñ</span> –ö—É—Ä—Å–∏</a></li>
          <li><a href="/admin/groups.html" class="active"><span class="icon">üë•</span> –ì—Ä—É–ø–∏</a></li>
          <li><a href="/admin/students.html"><span class="icon">üéì</span> –£—á–Ω—ñ</a></li>
          <li><a href="#" id="logout-btn"><span class="icon">üö™</span> –í–∏—Ö—ñ–¥</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <h1 class="header-title">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—Ä—É–ø–∞–º–∏</h1>
        <div class="header-actions">
          <button class="btn btn-primary" onclick="showCreateModal()">
            <span>‚ûï</span> –°—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É–ø—É
          </button>
        </div>
      </div>

      <!-- Groups List -->
      <div class="card">
        <div class="table-container" id="groups-container">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
      <a href="/admin/dashboard.html" class="bottom-nav-item">
        <span class="icon">üìä</span>
        <span>–ì–æ–ª–æ–≤–Ω–∞</span>
      </a>
      <a href="/admin/groups.html" class="bottom-nav-item active">
        <span class="icon">üë•</span>
        <span>–ì—Ä—É–ø–∏</span>
      </a>
      <a href="/admin/students.html" class="bottom-nav-item">
        <span class="icon">üéì</span>
        <span>–£—á–Ω—ñ</span>
      </a>
      <a href="/admin/settings.html" class="bottom-nav-item">
        <span class="icon">‚öôÔ∏è</span>
        <span>–©–µ</span>
      </a>
    </nav>
  </div>

  <!-- Create/Edit Modal -->
  <div class="modal" id="groupModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">–°—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É–ø—É</h2>
        <button class="modal-close" onclick="hideModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="groupForm">
          <input type="hidden" id="groupId" name="id">
          
          <div class="form-group">
            <label class="form-label">–ù–∞–∑–≤–∞ –≥—Ä—É–ø–∏ *</label>
            <input type="text" class="form-input" id="groupName" name="name" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">–ö—É—Ä—Å *</label>
            <select class="form-select" id="groupCourse" name="course_id" required>
              <option value="">–û–±–µ—Ä—ñ—Ç—å –∫—É—Ä—Å</option>
            </select>
          </div>
          
          <div class="grid grid-2">
            <div class="form-group">
              <label class="form-label">–ú–∞–∫—Å. —É—á–Ω—ñ–≤</label>
              <input type="number" class="form-input" id="groupMax" name="max_students" value="10" min="1" max="20">
            </div>
            
            <div class="form-group">
              <label class="form-label">–ö—ñ–º–Ω–∞—Ç–∞</label>
              <input type="text" class="form-input" id="groupRoom" name="room">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button class="btn btn-primary" onclick="saveGroup()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
      </div>
    </div>
  </div>

  <script src="/js/app.js"></script>
  <script>
    let groups = [];
    let courses = [];

    async function loadData() {
      try {
        UI.showLoading('groups-container');
        const [groupsRes, coursesRes] = await Promise.all([
          API.get('/groups'),
          API.get('/courses')
        ]);
        
        groups = groupsRes.groups || [];
        courses = coursesRes.courses || [];
        
        renderGroups();
        populateCourseSelect();
      } catch (error) {
        console.error('Error loading data:', error);
        UI.showError('groups-container', '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö');
      }
    }

    function populateCourseSelect() {
      const select = document.getElementById('groupCourse');
      select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –∫—É—Ä—Å</option>';
      courses.filter(c => c.is_active).forEach(course => {
        const option = document.createElement('option');
        option.value = course.id;
        option.textContent = course.name;
        select.appendChild(option);
      });
    }

    function renderGroups() {
      const container = document.getElementById('groups-container');
      
      if (groups.length === 0) {
        container.innerHTML = '<div class="text-center text-muted"><p>–ù–µ–º–∞—î –≥—Ä—É–ø. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à—É –≥—Ä—É–ø—É!</p></div>';
        return;
      }

      const table = Table.create(
        groups,
        [
          { label: '–ù–∞–∑–≤–∞', field: 'name' },
          { label: '–ö—É—Ä—Å', render: row => row.courses?.name || '-' },
          { label: '–ö—ñ–º–Ω–∞—Ç–∞', render: row => row.room || '-' },
          { label: '–£—á–Ω—ñ', render: row => `${row.current_students || 0}/${row.max_students || 10}` },
          { label: '–°—Ç–∞—Ç—É—Å', render: row => 
            `<span class="badge ${row.is_active ? 'badge-success' : 'badge-danger'}">
              ${row.is_active ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞'}
            </span>`
          }
        ],
        [
          { label: 'üëÅÔ∏è', class: 'btn-secondary', onClick: row => window.location.href = `/admin/group.html?id=${row.id}` },
          { label: '‚úèÔ∏è', class: 'btn-primary', onClick: editGroup },
          { label: 'üóëÔ∏è', class: 'btn-danger', onClick: deleteGroup }
        ]
      );

      container.innerHTML = '';
      container.appendChild(table);
    }

    function showCreateModal() {
      document.getElementById('modalTitle').textContent = '–°—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É–ø—É';
      Form.reset('groupForm');
      UI.showModal('groupModal');
    }

    function editGroup(group) {
      document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≥—Ä—É–ø—É';
      Form.setData('groupForm', group);
      UI.showModal('groupModal');
    }

    function hideModal() {
      UI.hideModal('groupModal');
    }

    async function saveGroup() {
      const form = document.getElementById('groupForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const data = Form.getData('groupForm');
      const groupId = data.id;
      delete data.id;

      try {
        if (groupId) {
          await API.put(`/groups/${groupId}`, data);
          UI.showAlert('–ì—Ä—É–ø—É –æ–Ω–æ–≤–ª–µ–Ω–æ', 'success');
        } else {
          await API.post('/groups', data);
          UI.showAlert('–ì—Ä—É–ø—É —Å—Ç–≤–æ—Ä–µ–Ω–æ', 'success');
        }
        
        hideModal();
        loadData();
      } catch (error) {
        UI.showAlert(error.message || '–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≥—Ä—É–ø–∏', 'danger');
      }
    }

    async function deleteGroup(group) {
      if (!confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≥—Ä—É–ø—É "${group.name}"?`)) {
        return;
      }

      try {
        await API.delete(`/groups/${group.id}`);
        UI.showAlert('–ì—Ä—É–ø—É –≤–∏–¥–∞–ª–µ–Ω–æ', 'success');
        loadData();
      } catch (error) {
        UI.showAlert(error.message || '–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≥—Ä—É–ø–∏', 'danger');
      }
    }

    // Load data on page load
    document.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>
