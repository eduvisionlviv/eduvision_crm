<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞–±—ñ–Ω–µ—Ç –±–∞—Ç—å–∫—ñ–≤ - EduVision CRM</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span>üìö</span>
        <span>EduVision CRM</span>
      </div>
      <nav>
        <ul class="sidebar-nav">
          <li><a href="/parent/dashboard.html" class="active"><span class="icon">üìä</span> –ì–æ–ª–æ–≤–Ω–∞</a></li>
          <li><a href="/parent/children.html"><span class="icon">üë∂</span> –ú–æ—ó –¥—ñ—Ç–∏</a></li>
          <li><a href="/parent/payments.html"><span class="icon">üí∞</span> –û–ø–ª–∞—Ç–∏</a></li>
          <li><a href="/parent/schedule.html"><span class="icon">üìÖ</span> –†–æ–∑–∫–ª–∞–¥</a></li>
          <li><a href="#" id="logout-btn"><span class="icon">üö™</span> –í–∏—Ö—ñ–¥</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <h1 class="header-title">–í—ñ—Ç–∞—î–º–æ, <span id="parent-name">–ë–∞—Ç—å–∫–æ/–ú–∞–º–∞</span>!</h1>
        <div class="header-actions">
          <span class="text-muted">–ö–∞–±—ñ–Ω–µ—Ç –±–∞—Ç—å–∫—ñ–≤</span>
        </div>
      </div>

      <!-- Info Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">–ú–æ—ó –¥—ñ—Ç–∏</h2>
        </div>
        <div class="card-body">
          <div id="children-container">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>
      </div>

      <!-- Quick Info -->
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">–ù–∞–π–±–ª–∏–∂—á—ñ –∑–∞–Ω—è—Ç—Ç—è</h3>
          </div>
          <div class="card-body">
            <div class="text-muted text-center">–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–Ω—è—Ç—å</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">–û—Å—Ç–∞–Ω–Ω—ñ –æ–ø–ª–∞—Ç–∏</h3>
          </div>
          <div class="card-body">
            <div id="payments-container">
              <div class="text-muted text-center">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
      <a href="/parent/dashboard.html" class="bottom-nav-item active">
        <span class="icon">üìä</span>
        <span>–ì–æ–ª–æ–≤–Ω–∞</span>
      </a>
      <a href="/parent/children.html" class="bottom-nav-item">
        <span class="icon">üë∂</span>
        <span>–î—ñ—Ç–∏</span>
      </a>
      <a href="/parent/payments.html" class="bottom-nav-item">
        <span class="icon">üí∞</span>
        <span>–û–ø–ª–∞—Ç–∏</span>
      </a>
      <a href="/parent/schedule.html" class="bottom-nav-item">
        <span class="icon">üìÖ</span>
        <span>–†–æ–∑–∫–ª–∞–¥</span>
      </a>
    </nav>
  </div>

  <script src="/js/app.js"></script>
  <script>
    async function loadParentDashboard() {
      try {
        if (User.data) {
          document.getElementById('parent-name').textContent = User.data.user_name || '–ë–∞—Ç—å–∫–æ/–ú–∞–º–∞';
          const parentId = User.data.user_id;

          // This is a placeholder - in real implementation, we'd fetch children data
          const container = document.getElementById('children-container');
          container.innerHTML = `
            <div class="text-center text-muted">
              <p>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥—ñ—Ç–µ–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è...</p>
              <p class="text-small">–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤–∞—à–∏—Ö –¥—ñ—Ç–µ–π.</p>
            </div>
          `;

          // Load recent payments
          const paymentsRes = await API.get(`/payments?parent_id=${parentId}`);
          const payments = paymentsRes.payments || [];
          renderPayments(payments.slice(0, 3));
        }
      } catch (error) {
        console.error('Error loading parent dashboard:', error);
        document.getElementById('children-container').innerHTML = 
          '<div class="text-muted text-center">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö</div>';
      }
    }

    function renderPayments(payments) {
      const container = document.getElementById('payments-container');
      
      if (payments.length === 0) {
        container.innerHTML = '<div class="text-muted text-center">–ù–µ–º–∞—î –æ–ø–ª–∞—Ç</div>';
        return;
      }

      const list = payments.map(p => `
        <div style="padding: 8px 0; border-bottom: 1px solid var(--border);">
          <div style="display: flex; justify-content: space-between;">
            <span>${UI.formatDate(p.paid_at)}</span>
            <span class="badge ${p.status === 'paid' ? 'badge-success' : 'badge-warning'}">
              ${p.status === 'paid' ? '–û–ø–ª–∞—á–µ–Ω–æ' : '–û—á—ñ–∫—É—î—Ç—å—Å—è'}
            </span>
          </div>
          <div style="font-weight: 600; color: var(--text-primary);">
            ${UI.formatCurrency(p.amount)}
          </div>
        </div>
      `).join('');

      container.innerHTML = list;
    }

    document.addEventListener('DOMContentLoaded', loadParentDashboard);
  </script>
</body>
</html>
